(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{424:function(t,a,r){"use strict";r.r(a);var s=r(55),o=Object(s.a)({},(function(){var t=this,a=t.$createElement,r=t._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"逆向"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#逆向"}},[t._v("#")]),t._v(" 逆向")]),t._v(" "),r("h2",{attrs:{id:"通过创建动态库framework去hook应用原理"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#通过创建动态库framework去hook应用原理"}},[t._v("#")]),t._v(" 通过创建动态库Framework去hook应用原理")]),t._v(" "),r("ul",[r("li",[r("ol",[r("li",[t._v("程序的Mach-O文件中有LoadCommands，dyld会加载链接库文件。")])])]),t._v(" "),r("li",[r("ol",{attrs:{start:"2"}},[r("li",[t._v("编写自己的动态库，使用runtime的方法交换替换掉app中的方法")])])]),t._v(" "),r("li",[r("ol",{attrs:{start:"3"}},[r("li",[t._v("使用yolib工具注入动态库")])])])]),t._v(" "),r("h2",{attrs:{id:"为什么fishhook只能改变系统方法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#为什么fishhook只能改变系统方法"}},[t._v("#")]),t._v(" 为什么fishhook只能改变系统方法")]),t._v(" "),r("p",[t._v("苹果为了节约内存，将系统的动态库放在内存的一块特殊区域，然后将这块区域共享给所有应用，由于苹果采用PIC技术，位置代码独立，在machO文件创建两张表，懒加载和非懒加载表，里面存放指向外面函数的地址（符号）。")]),t._v(" "),r("p",[t._v("当应用加载时，dylb会加载共享缓存，链接方法地址，fishhook通过符号表找到懒加载表中对应的函数地址，重新绑定地址，达成修改程序的流程的目的。")]),t._v(" "),r("p",[t._v("而我们自己写的方法， 没有办法在编译时就获得函数的地址，所以fishhook无法hook我们自己写的方法。")]),t._v(" "),r("h2",{attrs:{id:"越狱方法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#越狱方法"}},[t._v("#")]),t._v(" 越狱方法")]),t._v(" "),r("ul",[r("li",[t._v("非越狱：重签名，使用yolib工具注入动态库")]),t._v(" "),r("li",[t._v("越狱：使用cycript连接手机，获取布局相关信息，使用class-dump获取到应用的头文件信息。再用Logos语法编写代码注入。dyld源码中有个DYLD_INSERT_LIBRARY变量，如果不为空，回去加载注入的动态库。")])]),t._v(" "),r("h2",{attrs:{id:"反越狱方法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#反越狱方法"}},[t._v("#")]),t._v(" 反越狱方法")]),t._v(" "),r("ul",[r("li",[r("ol",[r("li",[t._v("防：Other link 添加Restrict字段  攻：修改MachO Restrict的地址  防：复制dyld中的hasRestrictedSegment源码，自己来检测")])])]),t._v(" "),r("li",[r("ol",{attrs:{start:"2"}},[r("li",[t._v("添加白名单")])])]),t._v(" "),r("li",[r("ol",{attrs:{start:"3"}},[r("li",[t._v("防：ptrace防止调试  攻：fishhook重新绑定符号  防：别人hook ptrace的时候，自己的ptrace已经调用。想要自己函数调用在最之前：自己写一个framework库，在库中写入ptrace(PT_DENY_ATTACH, 0, 0, 0);")])])])])])}),[],!1,null,null,null);a.default=o.exports}}]);